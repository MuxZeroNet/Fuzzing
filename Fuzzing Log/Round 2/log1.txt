Some type checking routines were added into Connection.py
Logging noise was reduced. New glitches were discovered.



`fallback.py` long call stack:
(./usr/lib/python2.7/dist-packages/msgpack/fallback.py)

Value unpack error was not handled properly.


[00:21:28] FileServer Conn#142 127.0.0.1    [v2] > Message should be a dict!
[00:21:28] FileServer Conn#142 127.0.0.1    [v2] > Message should be a dict!
[00:21:28] FileServer Conn#142 127.0.0.1    [v2] > [!!!] Unexpected Socket handler error: UnpackValueError: Unknown header: 0xc1 in Connection.py line 169 > fallback.py line 557 > fallback.py line 538 > fallback.py line 498 > fallback.py line 494
[00:21:28] FileServer Conn#142 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 0...
[00:21:28] FileServer Conn#143 127.0.0.1    [?] > Incoming connection...
[00:21:28] FileServer Conn#143 127.0.0.1    [v2] > Message should be a dict!
[00:21:28] FileServer Conn#143 127.0.0.1    [v2] > Message should be a dict!
[00:21:28] FileServer Conn#143 127.0.0.1    [v2] > Message should be a dict!
[00:21:28] FileServer Conn#143 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 0...




Type checking wasn't strictly enforced in `FileRequest.py`:


[00:33:54] FileServer Conn#334 127.0.0.1    [v2] > Message should be a dict!
[00:33:54] FileServer Conn#334 127.0.0.1    [v2] > Message should be a dict!
[00:33:54] FileServer Conn#334 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 0...
[00:33:54] FileServer Conn#335 127.0.0.1    [?] > Incoming connection...
[00:33:54] FileServer Conn#335 127.0.0.1    [v2] > Message should be a dict!
[00:33:54] FileServer Conn#335 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 0...
[00:33:54] FileServer Conn#336 127.0.0.1    [?] > Incoming connection...
[00:33:54] FileServer Conn#336 127.0.0.1    [v2] > [!!!] Unexpected Socket handler error: TypeError: argument of type 'NoneType' is not iterable in Connection.py line 177 > Connection.py line 295 > FileServer.py line 43 > FileRequest.py line 58
[00:33:54] FileServer Conn#336 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 0...


And msgpack Exception:


[00:33:54] FileServer Conn#337 127.0.0.1    [?] > Incoming connection...
[00:33:54] FileServer Conn#337 127.0.0.1    [v2] > [!!!] Unexpected Socket handler error: TypeError: unhashable type: 'dict' in Connection.py line 169 > fallback.py line 557 > fallback.py line 538
[00:33:54] FileServer Conn#337 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 1...
[00:33:54] FileServer Conn#338 127.0.0.1    [?] > Incoming connection...
[00:33:54] FileServer Conn#338 127.0.0.1    [v2] > Message should be a dict!
[00:33:54] FileServer Conn#338 127.0.0.1    [v2] > Message should be a dict!



Type errors appeared again:


[00:33:54] FileServer Conn#338 127.0.0.1    [v2] > Message should be a dict!
[00:33:54] FileServer Conn#338 127.0.0.1    [v2] > Message should be a dict!
[00:33:54] FileServer Conn#338 127.0.0.1    [v2] > Message should be a dict!
[00:33:54] FileServer Conn#338 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 0...
[00:33:54] FileServer Conn#339 127.0.0.1    [?] > Incoming connection...
[00:33:54] FileServer Conn#339 127.0.0.1    [v2] > [!!!] Unexpected Socket handler error: TypeError: argument of type 'NoneType' is not iterable in Connection.py line 177 > Connection.py line 295 > FileServer.py line 43 > FileRequest.py line 58
[00:33:54] FileServer Conn#339 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 0...
[00:33:54] FileServer Conn#340 127.0.0.1    [?] > Incoming connection...
[00:33:54] FileServer Conn#340 127.0.0.1    [v2] > Message should be a dict!
[00:33:54] FileServer Conn#340 127.0.0.1    [v2] > Message should be a dict!



OptionalManagerPlugin Key Error, same as the Key Error in Round 1:


[00:38:02] FileServer Conn#244 127.0.0.1    [v2] > Message should be a dict...
[00:38:02] FileServer Conn#244 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 0...
[00:38:02] FileServer Conn#245 127.0.0.1    [?] > Incoming connection...
[00:38:02] FileServer Conn#245 127.0.0.1    [v2] > [!!!] Unexpected Socket handler error: TypeError: unhashable type: 'dict' in Connection.py line 169 > fallback.py line 557 > fallback.py line 538
[00:38:02] FileServer Conn#245 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 1...
[00:38:02] FileServer Conn#246 127.0.0.1    [?] > Incoming connection...
[00:38:02] FileServer Conn#246 127.0.0.1    [v2] > [!!!] Unexpected Socket handler error: KeyError: 'site' in Connection.py line 177 > Connection.py line 293 > FileServer.py line 43 > FileRequest.py line 82 > OptionalManagerPlugin.py line 79 > FileRequest.py line 174
[00:38:02] FileServer Conn#246 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 0...
[00:38:02] FileServer Conn#247 127.0.0.1    [?] > Incoming connection...
[00:38:02] FileServer Conn#247 127.0.0.1    [v2] > [!!!] Unexpected Socket handler error: KeyError: 'site' in Connection.py line 177 > Connection.py line 293 > FileServer.py line 43 > FileRequest.py line 82 > OptionalManagerPlugin.py line 79 > FileRequest.py line 174
[00:38:02] FileServer Conn#247 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 0...



msgpack Error appeared again:


[00:38:02] FileServer Conn#248 127.0.0.1    [?] > Incoming connection...
[00:38:02] FileServer Conn#248 127.0.0.1    [v2] > [!!!] Unexpected Socket handler error: TypeError: unhashable type: 'dict' in Connection.py line 169 > fallback.py line 557 > fallback.py line 538
[00:38:02] FileServer Conn#248 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 2...
[00:38:02] FileServer Conn#249 127.0.0.1    [?] > Incoming connection...
[00:38:02] FileServer Conn#249 127.0.0.1    [v2] > [!!!] Unexpected Socket handler error: KeyError: 'site' in Connection.py line 177 > Connection.py line 293 > FileServer.py line 43 > FileRequest.py line 82 > OptionalManagerPlugin.py line 79 > FileRequest.py line 174
[00:38:02] FileServer Conn#249 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 0...
[00:38:03] FileServer Conn#250 127.0.0.1    [?] > Incoming connection...
[00:38:03] FileServer Conn#250 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 1...
[00:38:03] FileServer Conn#251 127.0.0.1    [?] > Incoming connection...
[00:38:03] FileServer Conn#251 127.0.0.1    [v2] > Message should be a dict...
[00:38:03] FileServer Conn#251 127.0.0.1    [v2] > Message should be a dict...
[00:38:03] FileServer Conn#251 127.0.0.1    [v2] > Message should be a dict...



[00:39:23] FileServer Conn# 8 127.0.0.1    [v2] > Message should be a dict...
[00:39:23] FileServer Conn# 8 127.0.0.1    [v2] > Message should be a dict...
[00:39:23] FileServer Conn# 8 127.0.0.1    [v2] > [!!!] Unexpected Socket handler error: ValueError: ('%s exceeds max_array_len(%s)', 4008636142, 2147483647) in Connection.py line 169 > fallback.py line 557 > fallback.py line 498 > fallback.py line 481
[00:39:23] FileServer Conn# 8 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 0...
[00:39:23] FileServer Conn# 9 127.0.0.1    [?] > Incoming connection...
[00:39:23] FileServer Conn# 9 127.0.0.1    [v2] > Message should be a dict...



[00:39:23] FileServer Conn#12 127.0.0.1    [v2] > Message should be a dict...
[00:39:23] FileServer Conn#12 127.0.0.1    [v2] > Message should be a dict...
[00:39:23] FileServer Conn#12 127.0.0.1    [v2] > [!!!] Unexpected Socket handler error: TypeError: unhashable type: 'list' in Connection.py line 169 > fallback.py line 557 > fallback.py line 537 > fallback.py line 538
[00:39:23] FileServer Conn#12 127.0.0.1    [v2] > Closing connection: MessageLoop ended, waiting_requests: 0, sites: 0, buff: 0...
[00:39:23] FileServer Conn#13 127.0.0.1    [?] > Incoming connection...
[00:39:23] FileServer Conn#13 127.0.0.1    [v2] > Message should be a dict...
